# 操作系统篇

## 进程及其实现

### 进程的定义和属性

#### 进程

​	进程是资源调度的基本单位，线程是CPU调度的基本单位。

​	进程提供两种虚拟机制：虚拟处理器和虚拟内存。

​	线程之间可以共享虚拟内存，但是每一个都有各自的虚拟处理器。

​	可以调用fork()来进行线程的复制，从而创建一个新的进程。调用fork()的进程为进程，新产生的进程为子进程。

​	内核通过一个为一个进程标识值或者PID来标识每一个进程，PID是一个数，实际上是一个int类型。

​	进程之间存在一个明显的继承关系。所有的进程都是PID为1的init进程的后代。

​	进程描述符之间有一个指向父进程的指针，和子进程的链表。

### 进程创建

​	linux创建进程的两个函数：fork()和exec()。首先fork函数通过拷贝当前进程创建一个子进程。父进程与子进程的区别仅仅在于PID、PPID和资源、统计量。

​	exec函数负责读取可执行文件将其载入地址空间运行。

​	fork函数使用写时拷贝页实现，写时拷贝是一种推迟甚至免拷贝数据的技术。内核并不复制这个那个进程地址空间，而是让父进程和子进程共享同一个拷贝。也就是只读共享，写入拷贝。

​	fork实际开销时复制父进程的页表以及给子进程分配唯一的进程描述符。

### 进程的状态和转换

#### 三状态模型

进程至少有3种状态：

1.运行态：进程占用处理器运行的状态。

2.就绪状态：进程具备运行状态，等待系统分配处理器以便其运行的状态。

3.等待态：也是组塞态或睡眠态，也是在等待某个状态完成的状态。

**进程状态转化**

![image-20180609210621293](/Users/youyujie/Documents/Java知识点复习图片/进程状态转化.png)

进程状态转化的原因:

1.运行态—>就绪态:运行进程等待使用某种资源或某事件发生。

2.等待态——>就绪态:所需资源得到满足。

3.运行态———>就绪态:运行时间片到了，或者更高优先级的进程。

4.就绪态———>运行态：CPU空闲，选择一个就绪进程。

#### **五状态模型**

​	新增两个状态：新建态和终止态。

新建态：进程被创建时的状态，进程尚未进入就绪队列，创建进程需要两步：1，为新进程分配所需资源，建立表的管理信息；然后设置此进程为就绪态，等待被调度执行。

终止态：进程完成任务，到达正常结束点。

#### **七状态模型**

![image-20180609211908960](/Users/youyujie/Documents/Java知识点复习图片/七状态模型.png)

状态转化具体原因：

![image-20180609211957398](/Users/youyujie/Documents/Java知识点复习图片/七状态转化原因.png)

### 进程的描述和组成

#### 进程映像

​	进程的状态在不断发生变化，某时刻进程的内容及其状态集合称为进程映像。主要包含以下要素：

1.进程控制块

​	存储进程标志信息、现场信息和控制信息

2.进程程序块

​	被执行的程序。

3.进程核心栈

​	保存中断／异常现场。

4.进程数据块

​	保存私有数据。

​	在操作系统中，进程物理试题和支持进程运行的环境合成为进程上下文。进程上下文有三个部分组成：

1.用户上下文

​	由正文、数据、共享存储区、用户栈组成，占用进程的虚拟地址空间。

2.寄存器上下文

​	指令计数器、栈指针、控制寄存器等组成。

3.系统上下文

​	由进程控制块、主存管理信息、核心栈组成。

## 线程及其实现

### 引入多线程的动机

​	为了减少程序并发执行时所付出的时空开销，是的并发力度更细、并发性更好。

### 线程的组成

​	线程时进程中能够并发执行的实体，是进程的组成部分，也是处理器调度和分配的基本单位。

进程的组成部分：

1.线程的唯一标识符以及线程状态信息

2.为运行所保存的线程上下；可以吧线程堪称进程中一个独立的程序计数器。

3.核心栈，在核心态工作时保存参数，在函数调用时的返回地址

4.用于存放线程局部变量和用户栈的私有存储区。

### 线程的状态

​	运行、就绪和等待状态，没有挂起状态。

​	多线程的优点是：提高系统性能，具体表现在快速线程切换，节省主存空间，减少管理开销；通信易于实现；并发程度高。

### 线程的实现

​	多线程的实现分为三类：用户级线程、内核级线程和混合方式。

**内核级线程**

​	线程的管理的工作由内核完成，内核为其创建进程和一个基线程。

​	优点：同时调度同一进程中的多个线程并发执行；运行速度快，执行效率高。

​	缺点：模式切换系统开销较大。

**用户级线程**

​	线程的管理是应用程序完成。

​	优点：线程切换无须使用内核特权方式。

​	缺点：一个用户线程的组塞英气整个进程的组塞。

**混合式线程**

​	即支持用户级线程，有支持内核级线程。

## 处理器调度

### 处理器调度的层次

1.高级调度

​	作业调度、长程调度，在多道批处理操作系统中，从输入系统的一批作业中按照预定的调度策略挑选若干的作业进入主存，为其分配所需的资源，并创建作恶的相应用户进程后便完成启动阶段的高级调度任务。

2.中级调度

​	平衡调度、中程调度，根据贮存资源决定主存中所能容纳的进程数量，并根据进程的当前状态来决定辅助存储器的主存中的进程的兑换。

3.低级调度

​	进程调度、线程调度、短程调度。主要的功能是根据某种原则决定就绪队列中的那些进程／内核级线程获得处理器，并将处理器出让给它使用。

### 处理器调度算法

​	低级调度的最初对象时进程。

#### 低级调度的基本类型

​	剥夺式算法

​	非剥夺式

#### 低级调度算法

**先来先服务(FCFS)**

​	非剥夺式调度算法，易于实现，但效率不高。

**最短作业优先算法(SJF)**

​	非剥夺式调度算法，易于实现，但执行效率不高。

**优先级调度算法**

​	根据线程的的优先级来运行。

**轮转调度算法**

​	也是时间片调度。

### 同步、通信和死锁

