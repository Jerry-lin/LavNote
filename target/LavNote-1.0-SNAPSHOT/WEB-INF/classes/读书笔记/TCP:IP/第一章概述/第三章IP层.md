# IP层复习

## 3.1引言

​	IP层提供**不可靠、无连接的服务**，不可靠指的是不能保证IP数据包能够成功到达目的地；无连接表示IP数据报并不维护任何关于后续数据报的状态信息。

![image-20180418210452993](/Users/youyujie/Documents/读书笔记/TCP:IP/第一章概述/虚电路和数据包服务比较.png)

**与IP配套的协议还有三种**

**ARP：地址解析协议**

**ICMP：网际控制报文协议**

**IGMP：网际组管理协议**

**物理层使用的中间设备叫转发器**

**数据链路层使用的设备是网桥或者交换机**

**网络层使用的是路由器**

**网络层以上使用的是网关**

## 3.2IP首部

普通的**IP首部长度为20字节**。具体的图解如下：

![image-20180418103832783](/Users/youyujie/Documents/读书笔记/TCP:IP/第一章概述/IP首部的数据格式.png)**首部长度指的是首部占 32 bit字的数目**，包括任何选项。由于它是一个 4比特字段，因此**首部最长为 6 0 个字节**。

服 务 类 型 ( T O S ) 字 段 包 括 一 个 3 b i t 的 优 先 权 子 字 段 ( 现 在 已 被 忽 略 )， 4 b i t 的 T O S 子字

段和 1 b i t 未 用 位 但 必 须 置 0 。 **4 b i t 的 T O S 分 别 代 表 : 最 小 时 延 、 最 大 吞 吐 量 、 最 高 可 靠 性 和 最小费用**。4 bit中只能置其中1 bit。如果所有4 bit均为0，那么就意味着是一般服务。

总长度字段是指整个 I P 数 据 报 的 长 度 ， 以 字 节 为 单 位 。 利 用 首 部 长 度 字 段 和 总 长 度 字 段 ，

就可以知道 I P 数据报中数据内容的起始位置和长度。**由于该字段长 1 6 比特，所以 I P 数据报最**
**长可达 6 5 5 3 5 字节**。

​	**T T L( t i m e - t o - l i v e ) 生 存 时 间 字 段 设 置 了 数 据 报 可 以 经 过 的 最 多 路 由 器 数 。 它 指 定 了 数 据报 的 生 存 时 间 。 T T L 的 初 始 值 由 源 主 机 设 置 ( 通 常 为 3 2 或 6 4 )， 一 旦 经 过 一 个 处 理 它 的 路 由 器 ，它的值就减去 1。当该字段的值为 0 时，数据报就被丢弃，并发送 I C M P 报文通知源主机**。

## 3.3子网寻址

​	所有的主机都支持子网寻址，这是将主机号在划分成一个子网号和主机号；这样做是A类地址和B类地址为主机分配了太多的空间，在现实中，可能不需要那么多的空间来支持。

## 3.4子网掩码

​	子网掩码的作用主要是来确定有多少位的主机段用于子网号，和主机号。在给定IP地址和子网掩码后，主机可以确定IP数据报的目的是：（1）本子网上的主机（2）本网络中其他子网的主机（3）其他网络的主机。

### 	特殊的IP地址

​		经过子网的划分，可以确定7个特定的IP地址，

​	![image-20180418141612682](/Users/youyujie/Documents/读书笔记/TCP:IP/第一章概述/特殊的IP地址.png)		
	

## 3.5ifconfig

​	ifconfig是对网络接口进行配置和查询的命令，ifconfig命令一般在引导时运行，以配置主机上的每个接口。

## 3.6netstat

​	netstat主要用于提供系统的接口命令。可以使用相关参数打印出每一个接口的MTU、输入分组数、输入错误、冲突以及当前的输出队列长度。

## 3.7分组转发算法

​	1.从数据报文中取出目的地址D，然后得到其网络地址N

​	2.如果N就是与路由器直接相连的网络地址，那么就直接交付，不需要任何主机，如果不是，那么执行地3步骤

​	3.如果路由表中有到达特定D的主机路由，那么就把数据报交个所指明的吓一跳路由

​	4.如果路由表有到达网络N的路由，那么就把数据报交个所指明的吓一跳路由

​	5.如果路由表中有一个默认的路由，那么就直接交个指明的下一跳路由

​	6.报告分组出错

## 3.8无分类编址CDIR		

CDIR的两个特点：

1.消除了传统的A类、B类、C类地址以及子网的划分，将IP地址由三级分类重新分为两级

2.将网络前缀相同的连续的IP地址组成一个CDIR地址块

使用CDIR时，形成了超网，即地址聚合，在路由查找下一跳时候，采用最长匹配

## 3.9ICMP

ICMP主要分为两种，ICMP差错报告报文和ICMP询问报文

ICMP差错报文有四种：

1.终点不可达

2.时间超过

3.参数问题

4.改变路由

ICMP询问报文：

1.回送请求和回答  用于是否可达以及了解相应状态

2.时间戳请求和回答	用于时间测量和时钟同步

## 3.10traceroute

用于跟踪一个分组从源点到终点所经过的路径

## 3.11内部网关协议IGP

​	含有RIP和OSFP协议，

## 3.12外部网关协议EGP

​	BGP协议

## 3.13IPV6

​	IPv6支持无连接，IPv6的主要特征有：

​	1.更大存址空间，IPv6的地址为128位

​	2.扩展的地址层次结构

​	3.灵活的首部格式

​	4.改进的选项

​	5.允许协议扩充

​	6.支持即插即用，IPv6不支持DHCP

​	7.支持资源的预分配

​	8.IPv6首部是8字节对齐

​		
​	