# 第三章 HTTP报文

## 3.1报文流

HTTP报文是在HTTP应用程序之间发送的数据块，这些数据块以一些**文本形式**的元数据开头。

### 3.1.1报文流入源端服务器

​	HTTP使用术语流入和流出来描述事务处理。

### 3.1.2报文向下游流动

​	所有的报文都向下游流动，报文的发送者都在接收端者的上游。

## 3.2报文的组成

​	报文主要由三个部分组成：起始行、包含属性的首部块、以及可选的、包含数据的主体部分。

​	起始行和首部都是由行分隔的ASCII文本，每行都是由两个字符组成的行终止序列作为结束，一个是**回车符**一个是**换行符**。

​	主体是一个可选的数据块，主要的是这里的数据可以是二进制数据和文本，或者是空。

### 3.2.1报文段的语法

​	所有的报文都可以分为两类：请求报文和响应报文。

​	请求报文向Web服务器请求一个动作，响应报文会将请求的报文返回给客户端。

​	请求报文格式

![image-20180502173652010](/Users/youyujie/Documents/读书笔记/TCP:IP/HTTP权威指南图片/请求报文格式.png)

​	响应报文格式

![image-20180502173749754](/Users/youyujie/Documents/读书笔记/TCP:IP/HTTP权威指南图片/响应报文格式.png)	

​	方法：例如GET、HEAD

​	请求URL：请求资源

​	版本：HTTP版本

​	状态码：发生的状态

​	原因短语：数字状态码的可读性版本

​	首部：可选字段，一般是报文长度，类型

​	主体：任意数据组层的数据块

### 3.2.2起始行

​	**1.请求行**

​	请求方法和URL、版本号等，使用空格分隔

​	**2.响应行**

​	HTTP版本、数字状态码、原因短语、

​	**3.方法**

​	请求的起始行以方法作为开始

​	常用的方法

​	GET				从服务器获取文档

​	HEAD			从服务器获取文档首部

​	POST			向服务器发送需要处理的数据

​	PUT				请求的主体存储在服务器上

​	TRACE			对报文进行追踪

​	OPTIONS		决定可以在服务器上执行哪些方法

​	DELETE			从服务器删除文档

​	**4.状态码**

整体范围		定义范围		分类

100-199		100-101		信息提示

200-299		200-206		成功

300-399		300-305		重定向

400-499		400-415		客户端错误

500-599		500-505		服务器错误

​	**5.短语原因**

​	为状态码做解释

​	**6.版本号**

​	遵守的协议

### 3.2.3首部

​	起始行后面是0或者多个HTTP首部字段，HTTP首部字段请求和响应报文添加了一些附加信息。本质上说是一些名/值对的列表。

​	**1.首部分类**

​	通用首部：可以出现在请求报文中，也可以出现在响应报文中

​	请求首部：提供能多相关请求的信息

​	响应首部:提供响应的信息

​	实体首部：主体的长度和内容，或者资源自身。

​	扩展首部：规范中没有定义的新首部

​	首部内容分行使用CRLF也就是\n\t

​	**2.首部延续行**

​	将长的内部行分为多行提高可读性，多出来的每行前面至少要有一个空格或者制表符。

### 3.2.4实体的主体部分

​	主体主要是HTTP要传输的内容

### 3.2.5版本0.9的报文

​	由请求和响应组成，请求中只包含方法和请求URL，响应中实体，没有版本信息，没有状态码或者短语，没有首部。

## 3.3方法

如果一台服务器要与HTTP1.1兼容，只要为其资源实现GET方法和HEAD方法就可以。

### 3.3.1安全方法

​	GET和HEAD方法被认为安全，这两个请求都不产生什么动作。

### 3.3.2GET

​	用于请求服务器发送某个资源。

### 3.3.3HEAD

​	服务器在响应中只返回首部。允许客户端在未获取实际资源的情况下，对资源的首部进行检查。

### 3.3.4PUT

​	向服务器写入文档。让服务器用请求的主体部分来常见一个由所请求的URL命名的文档，如果存在，用这个主体代替它。

### 3.3.5POST

​	向服务器请求数据，支持HTML表单

### 3.3.6TRACE

​	追踪报文的路径，主要用于诊断。

### 3.3.7OPTIONS

​	请求Web服务器告知支持的各种功能。可以询问服务器支持的那些方法，或者那些特殊资源支持方法。

### 3.3.8DELETE

​	请求服务器删除钦地区URL所制定的资源。

### 3.3.9扩展方法

​	COPY、LOCK、MVOE等

## 3.4状态码

​	状态码分为五类

### 3.4.1 100-199 信息性状态码

​	100Continue状态码：说明请求的初始化部分，请求客户端继续。

​	101:根据客户端指定，将协议且 切换成Update首部

​	**1.客户端与100Continue**	

​	客户端应用程序只有在避免向服务器发送一个服务器无法处理或者使用的大实体时，才应该使用100Continue。

​	**2.服务器与100Continue**

​	不主动向客户端发送这个状态码，除非出错

​	**3.代理与100Continue**

​	不知道下一跳服务器是否与HTTP/1.1兼容，封装Except向下转发，如果知道，返回417

### 3.4.2 200-209 成功状态码

​	200				请求成功

​	201				创建服务器对象请求

​	202				请求被接受，服务器没有执行任何动作

​	203				实体首部包含的信息不是来自源端服务器，而是来自资源的一份副本。

​	204				响应报文中国年包含若干首部和一个状态码，但是没有实体的主体部分

​	205				另一个主要用于浏览器的代码，晴空当前页面的HTML表单元素

​	206				成功执行一个部分的请求

### 3.4.3 300-399 重定向状态码

​	可以通过某些重定向状态码对资源的应用程序本地副本与远端服务器上的资源进行验证。

​	300				客户端请求一个实际指向多个资源的URL时会返回这个状态码

​	301 			请求的URL以被移除时使用，响应返回资源所在的URL

​	302				与301类似，但是请求仍然应使用老的URL。

​	303				告知客户端应该用另一个URL来获取资源。

​	304				客户端可以通过包含的请求首部，使其请求变成有条件的。

​	305				说明必须通过一个代理来访问资源。

​	306				当前未使用

​	307				与301类似，客户端应该使用Location首部给出的URL来临时定位资源，将来的请求应该使用老的URL

HTTP/1.0发送POST请求，收到302，期望HTTP客户端使用GET请求返回的URL。

HTTP/1.1使用303，对于客户端使用307代替302临时重定向

### 3.4.4 400-499 客户单错误状态码

​	400				客户端发送错误请求

​	401				请求客户端认证

​	402				未使用

​	403				服务器拒绝服务

​	404				资源没找到

​	405				不支持请求方法

​	406				服务器没有与客户端可接受的URL相匹配的资源

​	407				要求资源进行认证的代理服务器

​	408				请求超时

​	409				请求可能资源上英法德一些冲突

​	410				服务器以前拥有过资源，用于Web站点维护

​	411				服务器要求在报文中包含Content-Length首部

​	412				客户端请求条件失败了

​	413				请求实体过大

​	414				请求URL过长

​	415				服务器无法理解请求内容类型

​	416				请求范围无效

​	417				请求的Expect请求首部包含一个期望，服务器无法满足此期望。

### 3.4.5 500-599 服务器错误代码

​	500				服务器内部错误

​	501				请求超出服务器能力范围	

​	502				坏网关

​	503				无腹鳍现在无法提供服务

​	504				网关超时

​	505				请求无法支持此协议版本

## 3.5首部

### 3.5.1通用首部

​	提供与报文有关的最基本信息

​	通用缓存首部

### 3.5.2请求首部

​	用于请求首部

​	Accept首部

​	条件请求首部

​	安全请求首部

​	代理请求首部

### 3.5.3响应首部

​	用于响应

​	协商首部

​	安全响应首部

### 3.5.4实体首部

​	包含实体

​	内容首部

​	实体缓存首部





​	





​	





