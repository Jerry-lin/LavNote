# 常见的大数据面试题

## 1.如何利用zookeeper进行选举，画图说明 

### 	新的集群选举：

​	这里使用5台新启动的机器进行距离，机器的id从1-5，没有历史数据，数据量都是一样的，具体过程如下

1.id为1的机器启动，这个时候只有这台机器启动，它发出的数据报没有任何机器响应，一直处于Looking状态

2.id为2的机器启动，id为1的机器和id为2的机器相互交换选举结果，此时，id为2的机器胜出，由于没有达到半数以上的机器，那么这两台机器一值处于等待状态。

3.id为3的机器启动，此时三台机器相互通讯，交换选举结果，达到了半数以上的机器数量，然后id为3的机器胜出，变为leader。

4.id为4的机器启动，这个时候已经选举出id为3的机器，那么id为4的只能变为followerle

5.di为5的机器也是如此

### 	数据恢复阶段选举机制：

​		那么，初始化的时候，是按照上述的说明进行选举的，但是当zookeeper运行了一段时间之后，有机器down掉，重新选举时，选举过程就相对复杂了。

需要加入数据id、leader id和逻辑时钟。

数据id：数据新的id就大，数据每次更新都会更新id。

Leader id：就是我们配置的myid中的值，每个机器一个。

逻辑时钟：这个值从0开始递增,每次选举对应一个值,也就是说:  如果在同一次选举中,那么这个值应该是一致的 ;  逻辑时钟值越大,说明这一次选举leader的进程更新.

选举的标准就变成：

​                     1、逻辑时钟小的选举结果被忽略，重新投票

​                     2、统一逻辑时钟后，数据id大的胜出

​                     3、数据id相同的情况下，leader id大的胜出

​	根据这个规则选出leader。

## 2.用zookeeper做任务分配如何实现 

